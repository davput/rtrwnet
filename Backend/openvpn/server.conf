# OpenVPN Server - MikroTik + Kubernetes Stable

port 1194
proto udp4          # WAJIB: Hindari IPv6 NAT problem
dev tun

# Server network
server 10.8.0.0 255.255.255.0
topology subnet

# Certificates (server only)
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/server.crt
key /etc/openvpn/pki/server.key
dh /etc/openvpn/pki/dh.pem

# Username/Password authentication
auth-user-pass-verify /etc/openvpn/auth-user.sh via-env
script-security 3
username-as-common-name

# MikroTik compatibility
verify-client-cert none

cipher AES-256-CBC
data-ciphers AES-256-CBC
auth SHA256

tls-server
tls-version-min 1.0
tls-cipher DEFAULT

# NAT + Kubernetes FIX (PENTING)
float
explicit-exit-notify 1

tun-mtu 1400
mssfix 1360
fragment 1300

# Performance
keepalive 10 120
persist-key
persist-tun

# Client push
push "route 10.8.0.0 255.255.255.0"
push "dhcp-option DNS 1.1.1.1"
push "dhcp-option DNS 8.8.8.8"

# Session control
duplicate-cn
client-to-client
max-clients 100

# Compression OFF (security)
comp-lzo no
push "comp-lzo no"

# Logging
status /var/log/openvpn/status.log 10
log-append /var/log/openvpn/openvpn.log
verb 3
