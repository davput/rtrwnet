# Default virtual server for RT/RW Net SaaS
# Handles PPPoE/RADIUS authentication from MikroTik

server default {
    listen {
        type = auth
        ipaddr = *
        port = 1812
    }
    
    listen {
        type = acct
        ipaddr = *
        port = 1813
    }

    # Authorization - find user and set Auth-Type
    authorize {
        # Filter malformed usernames
        filter_username
        
        # Preprocess request
        preprocess
        
        # CHAP - sets Auth-Type = CHAP if CHAP-Password present
        chap
        
        # MS-CHAP - sets Auth-Type = MS-CHAP if MS-CHAP attributes present
        mschap
        
        # SQL lookup - gets Cleartext-Password from radcheck view
        sql
        
        # PAP - sets Auth-Type = PAP if Cleartext-Password exists
        # MUST be after sql so password is available
        pap
    }

    # Authentication - verify credentials
    authenticate {
        # PAP authentication (cleartext password comparison)
        Auth-Type PAP {
            pap
        }
        
        # CHAP authentication
        Auth-Type CHAP {
            chap
        }
        
        # MS-CHAP authentication (Windows/MikroTik)
        Auth-Type MS-CHAP {
            mschap
        }
    }

    # Pre-accounting
    preacct {
        preprocess
    }

    # Accounting - log session data
    accounting {
        sql
    }

    # Post-authentication - log auth attempts
    post-auth {
        sql
        
        Post-Auth-Type REJECT {
            sql
        }
    }

    # Session management
    session {
        sql
    }
}
