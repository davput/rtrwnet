openapi: 3.0.3
info:
  title: RT RW Net SaaS Backend API
  description: |
    API untuk sistem manajemen RT RW Net berbasis SaaS.
    
    ## Features
    - Multi-tenant architecture
    - JWT authentication
    - Free trial support
    - Subscription management
    - Customer management
    - Payment management
    - Service plan management
    - Ticket management
    - Infrastructure management (OLT, ODC, ODP)
    - Device management (MikroTik)
    
    ## Authentication
    Gunakan Bearer token di header Authorization:
    ```
    Authorization: Bearer <your_token>
    ```
    
    ## Tenant Identification
    Untuk protected endpoints, sertakan tenant ID di header:
    ```
    X-Tenant-ID: <tenant_id>
    ```
    
  version: 2.0.0
  contact:
    name: RT RW Net Support
    email: support@rtrwnet.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8089/api/v1
    description: Development server
  - url: https://api.rtrwnet.com/api/v1
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Public
    description: Public endpoints (no authentication required)
  - name: Authentication
    description: User authentication and authorization
  - name: Dashboard
    description: Dashboard overview and statistics
  - name: Customers
    description: Customer management
  - name: Payments
    description: Payment management
  - name: Service Plans
    description: Service plan management
  - name: Billing
    description: Subscription and billing management
  - name: Tickets
    description: Support ticket management
  - name: Infrastructure
    description: Network infrastructure management (OLT, ODC, ODP)
  - name: Devices
    description: Network device management
  - name: Settings
    description: User and tenant settings management
  - name: Tenants
    description: Tenant management

paths:
  # ==================== HEALTH ====================
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Check if the API is running
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  message:
                    type: string
                    example: RT/RW Net SaaS Backend is running

  # ==================== PUBLIC ====================
  /public/plans:
    get:
      tags: [Public]
      summary: Get subscription plans
      description: Retrieve all available subscription plans
      responses:
        '200':
          description: Plans retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlansResponse'

  /public/signup:
    post:
      tags: [Public]
      summary: Sign up new tenant
      description: Register a new tenant with optional free trial
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
      responses:
        '201':
          description: Sign up successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignUpResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          $ref: '#/components/responses/ValidationError'

  # ==================== AUTHENTICATION ====================
  /auth/register:
    post:
      tags: [Authentication]
      summary: Register new user
      description: Register a new user for existing tenant
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/login:
    post:
      tags: [Authentication]
      summary: Standard login (with tenant ID)
      description: Login with tenant ID, email, and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/simple-login:
    post:
      tags: [Authentication]
      summary: Simple login (email only)
      description: Login using email and password only. No tenant ID required.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SimpleLoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/refresh:
    post:
      tags: [Authentication]
      summary: Refresh access token
      description: Get new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/logout:
    post:
      tags: [Authentication]
      summary: Logout
      description: Invalidate refresh token
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'

  /auth/me:
    get:
      tags: [Authentication]
      summary: Get current user
      description: Get authenticated user information
      security:
        - BearerAuth: []
        - TenantID: []
      responses:
        '200':
          description: User information retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==================== DASHBOARD ====================
  /dashboard/overview:
    get:
      tags: [Dashboard]
      summary: Get dashboard overview
      description: Get complete dashboard statistics and recent activities
      security:
        - BearerAuth: []
        - TenantID: []
      responses:
        '200':
          description: Dashboard overview retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardOverviewResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==================== CUSTOMERS ====================
  /customers:
    get:
      tags: [Customers]
      summary: List customers
      description: Get paginated list of customers with optional filters
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: search
          in: query
          schema:
            type: string
          description: Search by name, customer code, phone
        - name: status
          in: query
          schema:
            type: string
            enum: [active, suspended, terminated]
        - name: service_plan_id
          in: query
          schema:
            type: string
            format: uuid
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [name, customer_code, installation_date]
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
      responses:
        '200':
          description: Customers retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerListResponse'
    post:
      tags: [Customers]
      summary: Create customer
      description: Create a new customer
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCustomerRequest'
      responses:
        '201':
          description: Customer created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerDetailResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /customers/{id}:
    get:
      tags: [Customers]
      summary: Get customer detail
      description: Get detailed customer information including payment history
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Customer detail retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Customers]
      summary: Update customer
      description: Update customer information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCustomerRequest'
      responses:
        '200':
          description: Customer updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerDetailResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Customers]
      summary: Delete customer
      description: Delete a customer
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== PAYMENTS ====================
  /payments:
    get:
      tags: [Payments]
      summary: List payments
      description: Get paginated list of payments
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, paid, overdue]
        - name: customer_id
          in: query
          schema:
            type: string
            format: uuid
        - name: month
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 12
        - name: year
          in: query
          schema:
            type: integer
            minimum: 2020
      responses:
        '200':
          description: Payments retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentListResponse'
    post:
      tags: [Payments]
      summary: Record payment
      description: Record a new payment for a customer
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecordPaymentRequest'
      responses:
        '201':
          description: Payment recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  # ==================== SERVICE PLANS ====================
  /service-plans:
    get:
      tags: [Service Plans]
      summary: List service plans
      description: Get list of service plans for the tenant
      security:
        - BearerAuth: []
        - TenantID: []
      responses:
        '200':
          description: Service plans retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServicePlanListResponse'
    post:
      tags: [Service Plans]
      summary: Create service plan
      description: Create a new service plan
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateServicePlanRequest'
      responses:
        '201':
          description: Service plan created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServicePlanSummary'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /service-plans/{id}:
    put:
      tags: [Service Plans]
      summary: Update service plan
      description: Update service plan information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateServicePlanRequest'
      responses:
        '200':
          description: Service plan updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServicePlanSummary'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Service Plans]
      summary: Delete service plan
      description: Delete a service plan
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== BILLING ====================
  /billing:
    get:
      tags: [Billing]
      summary: Get billing dashboard
      description: Get complete billing information including subscription, usage, and invoices
      security:
        - BearerAuth: []
        - TenantID: []
      responses:
        '200':
          description: Billing dashboard retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BillingDashboardResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /billing/subscription:
    put:
      tags: [Billing]
      summary: Update subscription
      description: Change subscription plan or settings
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSubscriptionRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'

  /billing/settings:
    put:
      tags: [Billing]
      summary: Update tenant basic info
      description: Update tenant basic information (name, email, phone)
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTenantBasicRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'

  /billing/cancel:
    post:
      tags: [Billing]
      summary: Cancel subscription
      description: Cancel current subscription
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelSubscriptionRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'

  /billing/payment-method:
    put:
      tags: [Billing]
      summary: Update payment method
      description: Update payment method for subscription
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePaymentMethodRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'

  # ==================== TICKETS ====================
  /tickets:
    get:
      tags: [Tickets]
      summary: List tickets
      description: Get paginated list of support tickets
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [open, in_progress, resolved, closed]
        - name: priority
          in: query
          schema:
            type: string
            enum: [low, medium, high, urgent]
        - name: customer_id
          in: query
          schema:
            type: string
            format: uuid
        - name: assigned_to
          in: query
          schema:
            type: string
            format: uuid
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Tickets retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TicketListResponse'
    post:
      tags: [Tickets]
      summary: Create ticket
      description: Create a new support ticket
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTicketRequest'
      responses:
        '201':
          description: Ticket created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TicketResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /tickets/{id}:
    get:
      tags: [Tickets]
      summary: Get ticket detail
      description: Get detailed ticket information including activities
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Ticket detail retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TicketDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Tickets]
      summary: Update ticket
      description: Update ticket information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTicketRequest'
      responses:
        '200':
          description: Ticket updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TicketResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /tickets/{id}/assign:
    post:
      tags: [Tickets]
      summary: Assign ticket
      description: Assign ticket to a user
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [assigned_to]
              properties:
                assigned_to:
                  type: string
                  format: uuid
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

  /tickets/{id}/resolve:
    post:
      tags: [Tickets]
      summary: Resolve ticket
      description: Mark ticket as resolved
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [resolution_notes]
              properties:
                resolution_notes:
                  type: string
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

  /tickets/{id}/close:
    post:
      tags: [Tickets]
      summary: Close ticket
      description: Mark ticket as closed
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'


  # ==================== INFRASTRUCTURE ====================
  /infrastructure/olts:
    get:
      tags: [Infrastructure]
      summary: List OLTs
      description: Get list of Optical Line Terminals
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: OLTs retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OLTListResponse'
    post:
      tags: [Infrastructure]
      summary: Create OLT
      description: Create a new Optical Line Terminal
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOLTRequest'
      responses:
        '201':
          description: OLT created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OLTResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /infrastructure/olts/{id}:
    get:
      tags: [Infrastructure]
      summary: Get OLT
      description: Get OLT by ID
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: OLT retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OLTResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Infrastructure]
      summary: Update OLT
      description: Update OLT information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOLTRequest'
      responses:
        '200':
          description: OLT updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OLTResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Infrastructure]
      summary: Delete OLT
      description: Delete an OLT
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'

  /infrastructure/odcs:
    get:
      tags: [Infrastructure]
      summary: List ODCs
      description: Get list of Optical Distribution Cabinets
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - name: olt_id
          in: query
          schema:
            type: string
            format: uuid
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: ODCs retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODCListResponse'
    post:
      tags: [Infrastructure]
      summary: Create ODC
      description: Create a new Optical Distribution Cabinet
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateODCRequest'
      responses:
        '201':
          description: ODC created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODCResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /infrastructure/odcs/{id}:
    get:
      tags: [Infrastructure]
      summary: Get ODC
      description: Get ODC by ID
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: ODC retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODCResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Infrastructure]
      summary: Update ODC
      description: Update ODC information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateODCRequest'
      responses:
        '200':
          description: ODC updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODCResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Infrastructure]
      summary: Delete ODC
      description: Delete an ODC
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'

  /infrastructure/odps:
    get:
      tags: [Infrastructure]
      summary: List ODPs
      description: Get list of Optical Distribution Points
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - name: odc_id
          in: query
          schema:
            type: string
            format: uuid
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: ODPs retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODPListResponse'
    post:
      tags: [Infrastructure]
      summary: Create ODP
      description: Create a new Optical Distribution Point
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateODPRequest'
      responses:
        '201':
          description: ODP created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODPResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /infrastructure/odps/{id}:
    get:
      tags: [Infrastructure]
      summary: Get ODP
      description: Get ODP by ID
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: ODP retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODPResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Infrastructure]
      summary: Update ODP
      description: Update ODP information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateODPRequest'
      responses:
        '200':
          description: ODP updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODPResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Infrastructure]
      summary: Delete ODP
      description: Delete an ODP
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== DEVICES ====================
  /devices:
    get:
      tags: [Devices]
      summary: List devices
      description: Get paginated list of network devices
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: device_type
          in: query
          schema:
            type: string
            enum: [mikrotik, olt, switch, router, ont]
        - name: status
          in: query
          schema:
            type: string
            enum: [online, offline, maintenance]
        - name: customer_id
          in: query
          schema:
            type: string
            format: uuid
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Devices retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceListResponse'
    post:
      tags: [Devices]
      summary: Create device
      description: Create a new network device
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDeviceRequest'
      responses:
        '201':
          description: Device created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /devices/{id}:
    get:
      tags: [Devices]
      summary: Get device
      description: Get device by ID
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Device retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Devices]
      summary: Update device
      description: Update device information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDeviceRequest'
      responses:
        '200':
          description: Device updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Devices]
      summary: Delete device
      description: Delete a device
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'

  /devices/{id}/test-connection:
    post:
      tags: [Devices]
      summary: Test MikroTik connection
      description: Test connection to a MikroTik device
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Connection test result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
        '404':
          $ref: '#/components/responses/NotFound'

  /devices/{id}/sync-queues:
    post:
      tags: [Devices]
      summary: Sync MikroTik queues
      description: Synchronize queues with MikroTik device
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== SETTINGS ====================
  /settings/user:
    get:
      tags: [Settings]
      summary: Get user settings
      description: Get current user's settings
      security:
        - BearerAuth: []
        - TenantID: []
      responses:
        '200':
          description: User settings retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSettingsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
    put:
      tags: [Settings]
      summary: Update user settings
      description: Update current user's settings
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserSettingsRequest'
      responses:
        '200':
          description: User settings updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSettingsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /settings/notifications:
    put:
      tags: [Settings]
      summary: Update notification settings
      description: Update user's notification preferences
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNotificationSettingsRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /settings/tenant:
    get:
      tags: [Settings]
      summary: Get tenant settings
      description: Get tenant/ISP settings (admin only)
      security:
        - BearerAuth: []
        - TenantID: []
      responses:
        '200':
          description: Tenant settings retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSettingsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - Admin only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags: [Settings]
      summary: Update tenant settings
      description: Update tenant/ISP settings (admin only)
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTenantSettingsRequest'
      responses:
        '200':
          description: Tenant settings updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSettingsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          description: Forbidden - Admin only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          $ref: '#/components/responses/ValidationError'

  /settings/integrations:
    put:
      tags: [Settings]
      summary: Update integration settings
      description: Update WhatsApp/Telegram integration settings (admin only)
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateIntegrationSettingsRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          description: Forbidden - Admin only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          $ref: '#/components/responses/ValidationError'

  /settings/profile:
    put:
      tags: [Settings]
      summary: Update user profile
      description: Update current user's profile information
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /settings/password:
    put:
      tags: [Settings]
      summary: Change password
      description: Change current user's password
      security:
        - BearerAuth: []
        - TenantID: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: Current password is incorrect
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          $ref: '#/components/responses/ValidationError'

  # ==================== TENANTS ====================
  /tenants/{id}:
    get:
      tags: [Tenants]
      summary: Get tenant
      description: Get tenant by ID

      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Tenant retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Tenants]
      summary: Update tenant
      description: Update tenant information
      security:
        - BearerAuth: []
        - TenantID: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTenantRequest'
      responses:
        '200':
          description: Tenant updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== WEBHOOKS ====================
  /webhooks/payment:
    post:
      tags: [Public]
      summary: Payment webhook
      description: Webhook endpoint for payment gateway callbacks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentWebhookRequest'
      responses:
        '200':
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'


components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from login response
    TenantID:
      type: apiKey
      in: header
      name: X-Tenant-ID
      description: Tenant ID for multi-tenant access

  parameters:
    IdParam:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Resource ID
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number
    PerPageParam:
      name: per_page
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10
      description: Items per page

  responses:
    Success:
      description: Operation successful
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessResponse'
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ValidationError:
      description: Validation error - input data tidak valid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationErrorResponse'
          examples:
            single_field:
              summary: Single field error
              value:
                success: false
                error:
                  code: VALIDATION_ERROR
                  message: Validation failed
                  details:
                    errors:
                      - field: email
                        message: Email format tidak valid
            multiple_fields:
              summary: Multiple field errors
              value:
                success: false
                error:
                  code: VALIDATION_ERROR
                  message: Validation failed
                  details:
                    errors:
                      - field: email
                        message: Email wajib diisi
                      - field: password
                        message: Password minimal 6 karakter
                      - field: phone
                        message: Format nomor telepon tidak valid

  schemas:
    # ==================== BASE SCHEMAS ====================
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation successful
        data:
          type: object
          nullable: true

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: AUTH_1001
            message:
              type: string
              example: Invalid credentials
            details:
              type: object
              additionalProperties: true

    ValidationErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: Validation failed
            details:
              type: object
              properties:
                errors:
                  type: array
                  items:
                    $ref: '#/components/schemas/FieldError'

    FieldError:
      type: object
      properties:
        field:
          type: string
          description: Nama field yang error
          example: email
        message:
          type: string
          description: Pesan error untuk field tersebut
          example: Email format tidak valid
        tag:
          type: string
          description: Validation tag yang gagal
          example: email
        value:
          type: string
          description: Nilai yang dikirim (opsional)
          example: invalid-email

    # ==================== AUTH SCHEMAS ====================
    RegisterRequest:
      type: object
      required: [tenant_id, email, password, name]
      properties:
        tenant_id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        name:
          type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        tenant_id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        password:
          type: string

    SimpleLoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          format: email
          description: Email address
        password:
          type: string

    RefreshTokenRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    LogoutRequest:
      type: object
      properties:
        refresh_token:
          type: string

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            access_token:
              type: string
            refresh_token:
              type: string
            expires_in:
              type: integer
            user:
              $ref: '#/components/schemas/UserInfo'
            tenant:
              $ref: '#/components/schemas/TenantInfo'

    RefreshTokenResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            access_token:
              type: string
            refresh_token:
              type: string
            expires_in:
              type: integer

    UserInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [admin, operator, technician, viewer]

    TenantInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        subdomain:
          type: string

    UserResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/UserInfo'

    # ==================== SUBSCRIPTION SCHEMAS ====================
    SignUpRequest:
      type: object
      required: [isp_name, email, password, phone, plan_id, owner_name]
      properties:
        isp_name:
          type: string
          minLength: 3
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        phone:
          type: string
        plan_id:
          type: string
          format: uuid
        owner_name:
          type: string
        use_trial:
          type: boolean
          default: false

    SignUpResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            tenant_id:
              type: string
              format: uuid
            user_id:
              type: string
              format: uuid
            order_id:
              type: string
              format: uuid
              nullable: true
            amount:
              type: number
            payment_url:
              type: string
              nullable: true
            is_trial:
              type: boolean
            trial_ends:
              type: string
              format: date
              nullable: true
            message:
              type: string

    PlansResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            plans:
              type: array
              items:
                $ref: '#/components/schemas/SubscriptionPlan'
            total:
              type: integer

    SubscriptionPlan:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        price:
          type: number
        billing_cycle:
          type: string
        max_customers:
          type: integer
        max_users:
          type: integer
        features:
          type: object
          additionalProperties: true
        is_active:
          type: boolean

    PaymentWebhookRequest:
      type: object
      required: [order_id, status]
      properties:
        order_id:
          type: string
        status:
          type: string
        amount:
          type: number
        payment_method:
          type: string
        gateway_transaction_id:
          type: string
        signature:
          type: string


    # ==================== DASHBOARD SCHEMAS ====================
    DashboardOverviewResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            statistics:
              $ref: '#/components/schemas/DashboardStatistics'
            revenue:
              $ref: '#/components/schemas/RevenueInfo'
            recent:
              $ref: '#/components/schemas/RecentActivities'
            charts:
              $ref: '#/components/schemas/DashboardCharts'

    DashboardStatistics:
      type: object
      properties:
        total_customers:
          type: integer
        active_customers:
          type: integer
        suspended_customers:
          type: integer
        new_customers_month:
          type: integer
        total_revenue:
          type: number
        monthly_revenue:
          type: number
        pending_payments:
          type: integer
        overdue_payments:
          type: integer

    RevenueInfo:
      type: object
      properties:
        this_month:
          type: number
        last_month:
          type: number
        growth:
          type: number
        collected:
          type: number
        pending:
          type: number
        overdue:
          type: number
        collection_rate:
          type: number

    RecentActivities:
      type: object
      properties:
        recent_payments:
          type: array
          items:
            $ref: '#/components/schemas/RecentPayment'
        recent_customers:
          type: array
          items:
            $ref: '#/components/schemas/RecentCustomer'
        alerts:
          type: array
          items:
            $ref: '#/components/schemas/Alert'

    RecentPayment:
      type: object
      properties:
        id:
          type: string
        customer_name:
          type: string
        customer_code:
          type: string
        amount:
          type: number
        payment_date:
          type: string
          format: date-time
        payment_method:
          type: string

    RecentCustomer:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        customer_code:
          type: string
        service_plan:
          type: string
        installation_date:
          type: string
          format: date-time
        status:
          type: string

    Alert:
      type: object
      properties:
        type:
          type: string
        message:
          type: string
        count:
          type: integer
        severity:
          type: string
          enum: [info, warning, error]
        date:
          type: string
          format: date-time

    DashboardCharts:
      type: object
      properties:
        revenue_chart:
          type: array
          items:
            $ref: '#/components/schemas/ChartData'
        customer_chart:
          type: array
          items:
            $ref: '#/components/schemas/ChartData'
        payment_status:
          $ref: '#/components/schemas/ChartData'

    ChartData:
      type: object
      properties:
        label:
          type: string
        value:
          type: number

    # ==================== CUSTOMER SCHEMAS ====================
    CustomerListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            customers:
              type: array
              items:
                $ref: '#/components/schemas/CustomerSummary'
            total:
              type: integer
            page:
              type: integer
            per_page:
              type: integer

    CustomerSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        customer_code:
          type: string
        name:
          type: string
        phone:
          type: string
        address:
          type: string
        service_plan:
          type: string
        monthly_fee:
          type: number
        status:
          type: string
          enum: [active, suspended, terminated]
        installation_date:
          type: string
          format: date-time
        last_payment:
          type: string
          format: date-time
          nullable: true
        payment_status:
          type: string
          enum: [paid, pending, overdue]

    CustomerDetailResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            customer_code:
              type: string
            name:
              type: string
            email:
              type: string
            phone:
              type: string
            address:
              type: string
            latitude:
              type: number
            longitude:
              type: number
            service_plan:
              $ref: '#/components/schemas/ServicePlanInfo'
            status:
              type: string
            installation_date:
              type: string
              format: date-time
            due_date:
              type: integer
            monthly_fee:
              type: number
            notes:
              type: string
            payment_history:
              type: array
              items:
                $ref: '#/components/schemas/PaymentHistory'
            statistics:
              $ref: '#/components/schemas/CustomerStatistics'

    ServicePlanInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        speed_download:
          type: integer
        speed_upload:
          type: integer
        price:
          type: number

    PaymentHistory:
      type: object
      properties:
        id:
          type: string
        amount:
          type: number
        payment_date:
          type: string
          format: date-time
          nullable: true
        due_date:
          type: string
          format: date-time
        status:
          type: string
        payment_method:
          type: string
        notes:
          type: string

    CustomerStatistics:
      type: object
      properties:
        total_payments:
          type: integer
        paid_payments:
          type: integer
        pending_payments:
          type: integer
        overdue_payments:
          type: integer
        total_paid:
          type: number
        total_pending:
          type: number
        on_time_rate:
          type: number

    CreateCustomerRequest:
      type: object
      required: [name, phone, address, service_plan_id, installation_date, due_date, monthly_fee]
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        address:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        service_plan_id:
          type: string
          format: uuid
        installation_date:
          type: string
          format: date-time
        due_date:
          type: integer
          minimum: 1
          maximum: 31
        monthly_fee:
          type: number
          minimum: 0
        notes:
          type: string

    UpdateCustomerRequest:
      type: object
      required: [name, phone, address, service_plan_id, due_date, monthly_fee, status]
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        address:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        service_plan_id:
          type: string
          format: uuid
        due_date:
          type: integer
          minimum: 1
          maximum: 31
        monthly_fee:
          type: number
          minimum: 0
        status:
          type: string
          enum: [active, suspended, terminated]
        notes:
          type: string


    # ==================== PAYMENT SCHEMAS ====================
    PaymentListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            payments:
              type: array
              items:
                $ref: '#/components/schemas/PaymentSummary'
            total:
              type: integer
            page:
              type: integer
            per_page:
              type: integer

    PaymentSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        customer_name:
          type: string
        customer_code:
          type: string
        amount:
          type: number
        payment_date:
          type: string
          format: date-time
          nullable: true
        due_date:
          type: string
          format: date-time
        status:
          type: string
          enum: [pending, paid, overdue]
        payment_method:
          type: string
        days_overdue:
          type: integer

    RecordPaymentRequest:
      type: object
      required: [customer_id, amount, payment_date, payment_method]
      properties:
        customer_id:
          type: string
          format: uuid
        amount:
          type: number
          minimum: 0
        payment_date:
          type: string
          format: date-time
        payment_method:
          type: string
          enum: [transfer, cash, e-wallet]
        notes:
          type: string

    # ==================== SERVICE PLAN SCHEMAS ====================
    ServicePlanListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            plans:
              type: array
              items:
                $ref: '#/components/schemas/ServicePlanSummary'
            total:
              type: integer

    ServicePlanSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        speed_download:
          type: integer
        speed_upload:
          type: integer
        price:
          type: number
        is_active:
          type: boolean
        customer_count:
          type: integer

    CreateServicePlanRequest:
      type: object
      required: [name, speed_download, speed_upload, price]
      properties:
        name:
          type: string
        description:
          type: string
        speed_download:
          type: integer
          minimum: 1
        speed_upload:
          type: integer
          minimum: 1
        price:
          type: number
          minimum: 0

    UpdateServicePlanRequest:
      type: object
      required: [name, speed_download, speed_upload, price]
      properties:
        name:
          type: string
        description:
          type: string
        speed_download:
          type: integer
          minimum: 1
        speed_upload:
          type: integer
          minimum: 1
        price:
          type: number
          minimum: 0
        is_active:
          type: boolean

    # ==================== BILLING SCHEMAS ====================
    BillingDashboardResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            tenant:
              $ref: '#/components/schemas/TenantBillingInfo'
            subscription:
              $ref: '#/components/schemas/SubscriptionBillingInfo'
            billing:
              $ref: '#/components/schemas/BillingDetails'
            usage:
              $ref: '#/components/schemas/UsageInfo'
            invoices:
              type: array
              items:
                $ref: '#/components/schemas/InvoiceInfo'

    TenantBillingInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        is_active:
          type: boolean

    SubscriptionBillingInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        plan_id:
          type: string
          format: uuid
        plan_name:
          type: string
        plan_slug:
          type: string
        status:
          type: string
          enum: [trial, active, expired, cancelled]
        is_trial:
          type: boolean
        start_date:
          type: string
          format: date-time
        end_date:
          type: string
          format: date-time
        next_billing_date:
          type: string
          format: date-time
          nullable: true
        days_left:
          type: integer
        auto_renew:
          type: boolean
        payment_method:
          type: string

    BillingDetails:
      type: object
      properties:
        current_plan:
          type: string
        monthly_price:
          type: number
        currency:
          type: string
        next_billing:
          type: string
        payment_method:
          type: string
        can_upgrade:
          type: boolean
        can_downgrade:
          type: boolean
        available_plans:
          type: array
          items:
            $ref: '#/components/schemas/PlanOption'

    PlanOption:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        price:
          type: number
        description:
          type: string
        is_current:
          type: boolean

    UsageInfo:
      type: object
      properties:
        current_period_start:
          type: string
          format: date-time
        current_period_end:
          type: string
          format: date-time
        days_used:
          type: integer
        days_remaining:
          type: integer

    InvoiceInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        invoice_no:
          type: string
        amount:
          type: number
        status:
          type: string
          enum: [pending, paid, failed, cancelled]
        issued_date:
          type: string
          format: date-time
        due_date:
          type: string
          format: date-time
        paid_date:
          type: string
          format: date-time
          nullable: true
        download_url:
          type: string
          nullable: true

    UpdateSubscriptionRequest:
      type: object
      required: [plan_id]
      properties:
        plan_id:
          type: string
          format: uuid
        payment_method:
          type: string
        auto_renew:
          type: boolean

    UpdateTenantBasicRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string

    CancelSubscriptionRequest:
      type: object
      properties:
        reason:
          type: string

    UpdatePaymentMethodRequest:
      type: object
      required: [payment_method]
      properties:
        payment_method:
          type: string
        card_number:
          type: string
        card_holder:
          type: string
        expiry_month:
          type: integer
        expiry_year:
          type: integer


    # ==================== TICKET SCHEMAS ====================
    TicketListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            tickets:
              type: array
              items:
                $ref: '#/components/schemas/TicketSummary'
            pagination:
              $ref: '#/components/schemas/Pagination'

    TicketSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        ticket_number:
          type: string
        title:
          type: string
        status:
          type: string
          enum: [open, in_progress, resolved, closed]
        priority:
          type: string
          enum: [low, medium, high, urgent]
        customer_id:
          type: string
          format: uuid
        customer_name:
          type: string
        assigned_to:
          type: string
          format: uuid
          nullable: true
        assigned_to_name:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TicketResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/TicketSummary'

    TicketDetailResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            ticket_number:
              type: string
            title:
              type: string
            description:
              type: string
            status:
              type: string
            priority:
              type: string
            customer_id:
              type: string
              format: uuid
            customer_name:
              type: string
            assigned_to:
              type: string
              format: uuid
              nullable: true
            assigned_to_name:
              type: string
              nullable: true
            resolution_notes:
              type: string
              nullable: true
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time
            resolved_at:
              type: string
              format: date-time
              nullable: true
            closed_at:
              type: string
              format: date-time
              nullable: true
            activities:
              type: array
              items:
                $ref: '#/components/schemas/TicketActivity'

    TicketActivity:
      type: object
      properties:
        id:
          type: string
          format: uuid
        action:
          type: string
        description:
          type: string
        user_id:
          type: string
          format: uuid
        user_name:
          type: string
        created_at:
          type: string
          format: date-time

    CreateTicketRequest:
      type: object
      required: [customer_id, title, description, priority]
      properties:
        customer_id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, medium, high, urgent]

    UpdateTicketRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, medium, high, urgent]
        status:
          type: string
          enum: [open, in_progress, resolved, closed]

    Pagination:
      type: object
      properties:
        page:
          type: integer
        per_page:
          type: integer
        total:
          type: integer

    # ==================== INFRASTRUCTURE SCHEMAS ====================
    OLTListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/OLT'

    OLTResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/OLT'

    OLT:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        brand:
          type: string
        model:
          type: string
        ip_address:
          type: string
        location:
          type: string
        total_ports:
          type: integer
        used_ports:
          type: integer
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateOLTRequest:
      type: object
      required: [name, brand, model, ip_address, total_ports]
      properties:
        name:
          type: string
        brand:
          type: string
        model:
          type: string
        ip_address:
          type: string
        location:
          type: string
        total_ports:
          type: integer
          minimum: 1

    UpdateOLTRequest:
      type: object
      properties:
        name:
          type: string
        brand:
          type: string
        model:
          type: string
        ip_address:
          type: string
        location:
          type: string
        total_ports:
          type: integer
        is_active:
          type: boolean

    ODCListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/ODC'

    ODCResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/ODC'

    ODC:
      type: object
      properties:
        id:
          type: string
          format: uuid
        olt_id:
          type: string
          format: uuid
        name:
          type: string
        location:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        total_ports:
          type: integer
        used_ports:
          type: integer
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateODCRequest:
      type: object
      required: [olt_id, name, total_ports]
      properties:
        olt_id:
          type: string
          format: uuid
        name:
          type: string
        location:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        total_ports:
          type: integer
          minimum: 1

    UpdateODCRequest:
      type: object
      properties:
        name:
          type: string
        location:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        total_ports:
          type: integer
        is_active:
          type: boolean

    ODPListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/ODP'

    ODPResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/ODP'

    ODP:
      type: object
      properties:
        id:
          type: string
          format: uuid
        odc_id:
          type: string
          format: uuid
        name:
          type: string
        location:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        total_ports:
          type: integer
        used_ports:
          type: integer
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateODPRequest:
      type: object
      required: [odc_id, name, total_ports]
      properties:
        odc_id:
          type: string
          format: uuid
        name:
          type: string
        location:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        total_ports:
          type: integer
          minimum: 1

    UpdateODPRequest:
      type: object
      properties:
        name:
          type: string
        location:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        total_ports:
          type: integer
        is_active:
          type: boolean


    # ==================== DEVICE SCHEMAS ====================
    DeviceListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            devices:
              type: array
              items:
                $ref: '#/components/schemas/Device'
            pagination:
              $ref: '#/components/schemas/Pagination'

    DeviceResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/Device'

    Device:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        device_type:
          type: string
          enum: [mikrotik, olt, switch, router, ont]
        brand:
          type: string
        model:
          type: string
        serial_number:
          type: string
        mac_address:
          type: string
        ip_address:
          type: string
        username:
          type: string
        port:
          type: integer
        customer_id:
          type: string
          format: uuid
          nullable: true
        status:
          type: string
          enum: [online, offline, maintenance]
        last_seen:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateDeviceRequest:
      type: object
      required: [name, device_type, ip_address]
      properties:
        name:
          type: string
        device_type:
          type: string
          enum: [mikrotik, olt, switch, router, ont]
        brand:
          type: string
        model:
          type: string
        serial_number:
          type: string
        mac_address:
          type: string
        ip_address:
          type: string
        username:
          type: string
        password:
          type: string
        port:
          type: integer
        customer_id:
          type: string
          format: uuid

    UpdateDeviceRequest:
      type: object
      properties:
        name:
          type: string
        device_type:
          type: string
          enum: [mikrotik, olt, switch, router, ont]
        brand:
          type: string
        model:
          type: string
        serial_number:
          type: string
        mac_address:
          type: string
        ip_address:
          type: string
        username:
          type: string
        password:
          type: string
        port:
          type: integer
        customer_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [online, offline, maintenance]

    # ==================== SETTINGS SCHEMAS ====================
    UserSettingsResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            user_id:
              type: string
              format: uuid
            email_notifications:
              type: boolean
            payment_notifications:
              type: boolean
            system_notifications:
              type: boolean
            marketing_notifications:
              type: boolean
            language:
              type: string
              example: id
            timezone:
              type: string
              example: Asia/Jakarta
            date_format:
              type: string
              example: DD/MM/YYYY

    UpdateUserSettingsRequest:
      type: object
      properties:
        email_notifications:
          type: boolean
        payment_notifications:
          type: boolean
        system_notifications:
          type: boolean
        marketing_notifications:
          type: boolean
        language:
          type: string
        timezone:
          type: string
        date_format:
          type: string

    UpdateNotificationSettingsRequest:
      type: object
      properties:
        email_notifications:
          type: boolean
        payment_notifications:
          type: boolean
        system_notifications:
          type: boolean
        marketing_notifications:
          type: boolean

    TenantSettingsResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            tenant_id:
              type: string
              format: uuid
            company_name:
              type: string
            company_address:
              type: string
            company_phone:
              type: string
            company_email:
              type: string
              format: email
            company_logo:
              type: string
            default_due_date:
              type: integer
              minimum: 1
              maximum: 31
            grace_period_days:
              type: integer
            auto_suspend_enabled:
              type: boolean
            auto_suspend_days:
              type: integer
            invoice_prefix:
              type: string
            invoice_footer:
              type: string
            tax_enabled:
              type: boolean
            tax_percentage:
              type: number
            send_payment_reminder:
              type: boolean
            reminder_days_before:
              type: integer
            send_overdue_notice:
              type: boolean
            whatsapp_enabled:
              type: boolean
            telegram_enabled:
              type: boolean

    UpdateTenantSettingsRequest:
      type: object
      properties:
        company_name:
          type: string
        company_address:
          type: string
        company_phone:
          type: string
        company_email:
          type: string
          format: email
        default_due_date:
          type: integer
          minimum: 1
          maximum: 31
        grace_period_days:
          type: integer
          minimum: 0
          maximum: 30
        auto_suspend_enabled:
          type: boolean
        auto_suspend_days:
          type: integer
          minimum: 1
          maximum: 60
        invoice_prefix:
          type: string
        invoice_footer:
          type: string
        tax_enabled:
          type: boolean
        tax_percentage:
          type: number
          minimum: 0
          maximum: 100
        send_payment_reminder:
          type: boolean
        reminder_days_before:
          type: integer
          minimum: 1
          maximum: 14
        send_overdue_notice:
          type: boolean

    UpdateIntegrationSettingsRequest:
      type: object
      properties:
        whatsapp_enabled:
          type: boolean
        whatsapp_api_key:
          type: string
        telegram_enabled:
          type: boolean
        telegram_bot_token:
          type: string

    UpdateProfileRequest:
      type: object
      required: [name, email]
      properties:
        name:
          type: string
          minLength: 2
        email:
          type: string
          format: email
        phone:
          type: string

    ChangePasswordRequest:
      type: object
      required: [current_password, new_password, confirm_password]
      properties:
        current_password:
          type: string
        new_password:
          type: string
          minLength: 6
        confirm_password:
          type: string
          minLength: 6

    # ==================== TENANT SCHEMAS ====================
    TenantResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/Tenant'

    Tenant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        subdomain:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UpdateTenantRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
