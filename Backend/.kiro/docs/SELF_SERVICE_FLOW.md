# Self-Service SaaS Flow - RT/RW Net Platform

## Overview

Model bisnis dimana **ISP owner** bisa langsung:
1. âœ… Sign up sendiri
2. âœ… Pilih paket subscription
3. âœ… Bayar online
4. âœ… Langsung dapat akses platform

**No manual approval needed!** ðŸš€

---

## Alur Lengkap Self-Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Landing Page                              â”‚
â”‚  https://rtrwnet-saas.com                                    â”‚
â”‚                                                              â”‚
â”‚  [Pricing] [Features] [Demo] [Sign Up]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Step 1: Sign Up                             â”‚
â”‚  User mengisi form:                                          â”‚
â”‚  â€¢ ISP Name                                                  â”‚
â”‚  â€¢ Subdomain (e.g., "jakartimur")                            â”‚
â”‚  â€¢ Email                                                     â”‚
â”‚  â€¢ Password                                                  â”‚
â”‚  â€¢ Phone                                                     â”‚
â”‚                                                              â”‚
â”‚  [Create Account]                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Step 2: Choose Plan                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  BASIC   â”‚  â”‚ STANDARD â”‚  â”‚ PREMIUM  â”‚                 â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚                 â”‚
â”‚  â”‚ 50 cust  â”‚  â”‚ 200 cust â”‚  â”‚ Unlimitedâ”‚                 â”‚
â”‚  â”‚ 2 users  â”‚  â”‚ 10 users â”‚  â”‚ Unlimitedâ”‚                 â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚                 â”‚
â”‚  â”‚ Rp 99K   â”‚  â”‚ Rp 299K  â”‚  â”‚ Rp 999K  â”‚                 â”‚
â”‚  â”‚ /month   â”‚  â”‚ /month   â”‚  â”‚ /month   â”‚                 â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚                 â”‚
â”‚  â”‚ [Select] â”‚  â”‚ [Select] â”‚  â”‚ [Select] â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Step 3: Payment                             â”‚
â”‚                                                              â”‚
â”‚  Order Summary:                                              â”‚
â”‚  â€¢ Plan: Standard                                            â”‚
â”‚  â€¢ Price: Rp 299,000/month                                   â”‚
â”‚  â€¢ Billing: Monthly                                          â”‚
â”‚                                                              â”‚
â”‚  Payment Method:                                             â”‚
â”‚  â—‹ Credit Card                                               â”‚
â”‚  â—‹ Bank Transfer                                             â”‚
â”‚  â—‹ E-Wallet (GoPay, OVO, Dana)                               â”‚
â”‚                                                              â”‚
â”‚  [Complete Payment]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Step 4: Activation                          â”‚
â”‚                                                              â”‚
â”‚  âœ… Payment Confirmed!                                       â”‚
â”‚  âœ… Tenant Created                                           â”‚
â”‚  âœ… Admin Account Activated                                  â”‚
â”‚  âœ… Database Initialized                                     â”‚
â”‚                                                              â”‚
â”‚  Your platform is ready!                                     â”‚
â”‚  Access: https://jakartimur.rtrwnet.com                     â”‚
â”‚                                                              â”‚
â”‚  [Go to Dashboard]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Step 5: Onboarding                          â”‚
â”‚                                                              â”‚
â”‚  Welcome to RT/RW Net Platform! ðŸ‘‹                          â”‚
â”‚                                                              â”‚
â”‚  Quick Setup:                                                â”‚
â”‚  1. âœ… Add your team members                                 â”‚
â”‚  2. âœ… Create service plans                                  â”‚
â”‚  3. âœ… Setup MikroTik router                                 â”‚
â”‚  4. âœ… Add your first customer                               â”‚
â”‚                                                              â”‚
â”‚  [Start Setup Wizard]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoints yang Dibutuhkan

### 1. Public Sign Up Endpoint

```
POST /api/v1/public/signup
```

**Request:**
```json
{
  "isp_name": "ISP Jakarta Timur",
  "subdomain": "jakartimur",
  "email": "owner@jakartimur.com",
  "password": "secure123",
  "phone": "08123456789",
  "plan_id": "plan-standard-uuid"
}
```

**Response:**
```json
{
  "tenant_id": "tenant-uuid",
  "user_id": "user-uuid",
  "payment_url": "https://payment.gateway.com/invoice/xxx",
  "message": "Please complete payment to activate your account"
}
```

### 2. Payment Callback Endpoint

```
POST /api/v1/webhooks/payment
```

**Request (from payment gateway):**
```json
{
  "order_id": "ORDER-123",
  "tenant_id": "tenant-uuid",
  "status": "paid",
  "amount": 299000,
  "payment_method": "credit_card"
}
```

**Action:**
- Activate tenant
- Send welcome email
- Initialize default data

### 3. Subscription Plans Endpoint

```
GET /api/v1/public/plans
```

**Response:**
```json
{
  "plans": [
    {
      "id": "plan-basic-uuid",
      "name": "Basic",
      "price": 99000,
      "billing_cycle": "monthly",
      "features": {
        "max_customers": 50,
        "max_users": 2,
        "support": "email"
      }
    },
    {
      "id": "plan-standard-uuid",
      "name": "Standard",
      "price": 299000,
      "billing_cycle": "monthly",
      "features": {
        "max_customers": 200,
        "max_users": 10,
        "support": "priority"
      }
    },
    {
      "id": "plan-premium-uuid",
      "name": "Premium",
      "price": 999000,
      "billing_cycle": "monthly",
      "features": {
        "max_customers": -1,
        "max_users": -1,
        "support": "24/7"
      }
    }
  ]
}
```

---

## Database Schema Tambahan

### Subscription Plans Table

```sql
CREATE TABLE subscription_plans (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    billing_cycle VARCHAR(20) NOT NULL, -- monthly, yearly
    max_customers INTEGER, -- -1 = unlimited
    max_users INTEGER,
    features JSONB,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Seed data
INSERT INTO subscription_plans (name, slug, price, billing_cycle, max_customers, max_users, features) VALUES
('Basic', 'basic', 99000, 'monthly', 50, 2, '{"support": "email", "storage": "5GB"}'),
('Standard', 'standard', 299000, 'monthly', 200, 10, '{"support": "priority", "storage": "20GB"}'),
('Premium', 'premium', 999000, 'monthly', -1, -1, '{"support": "24/7", "storage": "unlimited"}');
```

### Tenant Subscriptions Table

```sql
CREATE TABLE tenant_subscriptions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    plan_id UUID NOT NULL REFERENCES subscription_plans(id),
    status VARCHAR(20) NOT NULL, -- pending, active, suspended, cancelled
    start_date TIMESTAMP,
    end_date TIMESTAMP,
    next_billing_date TIMESTAMP,
    payment_method VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Payment Transactions Table

```sql
CREATE TABLE payment_transactions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    subscription_id UUID REFERENCES tenant_subscriptions(id),
    order_id VARCHAR(100) UNIQUE NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) NOT NULL, -- pending, paid, failed, refunded
    payment_method VARCHAR(50),
    payment_gateway VARCHAR(50), -- midtrans, xendit, stripe
    gateway_transaction_id VARCHAR(255),
    paid_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## Complete Flow Implementation

### Step 1: User Sign Up

```javascript
// Frontend
const signUp = async () => {
  const response = await fetch('/api/v1/public/signup', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      isp_name: 'ISP Jakarta Timur',
      subdomain: 'jakartimur',
      email: 'owner@jakartimur.com',
      password: 'secure123',
      phone: '08123456789',
      plan_id: 'plan-standard-uuid'
    })
  });
  
  const data = await response.json();
  
  // Redirect to payment
  window.location.href = data.payment_url;
};
```

### Step 2: Backend Process Sign Up

```go
// SignUp handler
func (h *PublicHandler) SignUp(c *gin.Context) {
    var req SignUpRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    // 1. Create tenant (status = pending)
    tenant := &entity.Tenant{
        Name:      req.ISPName,
        Subdomain: req.Subdomain,
        IsActive:  false, // Not active until payment
    }
    tenantRepo.Create(ctx, tenant)
    
    // 2. Create admin user
    hashedPassword, _ := auth.HashPassword(req.Password)
    user := &entity.User{
        TenantID: tenant.ID,
        Email:    req.Email,
        Password: hashedPassword,
        Name:     req.ISPName + " Admin",
        Role:     "admin",
        IsActive: false, // Not active until payment
    }
    userRepo.Create(ctx, user)
    
    // 3. Create subscription (status = pending)
    subscription := &entity.TenantSubscription{
        TenantID: tenant.ID,
        PlanID:   req.PlanID,
        Status:   "pending",
    }
    subscriptionRepo.Create(ctx, subscription)
    
    // 4. Create payment order
    plan, _ := planRepo.FindByID(ctx, req.PlanID)
    orderID := generateOrderID()
    
    transaction := &entity.PaymentTransaction{
        TenantID:       tenant.ID,
        SubscriptionID: subscription.ID,
        OrderID:        orderID,
        Amount:         plan.Price,
        Status:         "pending",
    }
    transactionRepo.Create(ctx, transaction)
    
    // 5. Generate payment URL (Midtrans/Xendit)
    paymentURL := paymentGateway.CreateInvoice(orderID, plan.Price, user.Email)
    
    c.JSON(201, gin.H{
        "tenant_id":   tenant.ID,
        "user_id":     user.ID,
        "payment_url": paymentURL,
        "message":     "Please complete payment to activate",
    })
}
```

### Step 3: Payment Gateway Callback

```go
// Payment webhook handler
func (h *WebhookHandler) PaymentCallback(c *gin.Context) {
    var webhook PaymentWebhook
    if err := c.ShouldBindJSON(&webhook); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    // Verify webhook signature
    if !paymentGateway.VerifySignature(webhook) {
        c.JSON(401, gin.H{"error": "Invalid signature"})
        return
    }
    
    if webhook.Status == "paid" {
        // 1. Update transaction
        transaction, _ := transactionRepo.FindByOrderID(ctx, webhook.OrderID)
        transaction.Status = "paid"
        transaction.PaidAt = time.Now()
        transactionRepo.Update(ctx, transaction)
        
        // 2. Activate subscription
        subscription, _ := subscriptionRepo.FindByID(ctx, transaction.SubscriptionID)
        subscription.Status = "active"
        subscription.StartDate = time.Now()
        subscription.EndDate = time.Now().AddDate(0, 1, 0) // +1 month
        subscription.NextBillingDate = time.Now().AddDate(0, 1, 0)
        subscriptionRepo.Update(ctx, subscription)
        
        // 3. Activate tenant
        tenant, _ := tenantRepo.FindByID(ctx, transaction.TenantID)
        tenant.IsActive = true
        tenantRepo.Update(ctx, tenant)
        
        // 4. Activate user
        users, _ := userRepo.FindAll(ctx, tenant.ID)
        for _, user := range users {
            user.IsActive = true
            userRepo.Update(ctx, user)
        }
        
        // 5. Initialize default data
        initializeDefaultData(tenant.ID)
        
        // 6. Send welcome email
        emailService.SendWelcomeEmail(user.Email, tenant)
        
        logger.Info("Tenant activated: %s", tenant.ID)
    }
    
    c.JSON(200, gin.H{"status": "ok"})
}
```

### Step 4: Initialize Default Data

```go
func initializeDefaultData(tenantID string) {
    // Create default service plans
    plans := []entity.ServicePlan{
        {
            TenantID:      tenantID,
            Name:          "10 Mbps",
            SpeedDownload: 10,
            SpeedUpload:   10,
            Price:         150000,
            IsActive:      true,
        },
        {
            TenantID:      tenantID,
            Name:          "20 Mbps",
            SpeedDownload: 20,
            SpeedUpload:   20,
            Price:         250000,
            IsActive:      true,
        },
    }
    
    for _, plan := range plans {
        servicePlanRepo.Create(ctx, &plan)
    }
    
    // Create sample data for demo
    // ...
}
```

---

## Pricing Page Example

```html
<!DOCTYPE html>
<html>
<head>
    <title>RT/RW Net SaaS - Pricing</title>
</head>
<body>
    <h1>Choose Your Plan</h1>
    
    <div class="pricing-cards">
        <!-- Basic Plan -->
        <div class="card">
            <h2>Basic</h2>
            <p class="price">Rp 99,000<span>/month</span></p>
            <ul>
                <li>âœ… Up to 50 customers</li>
                <li>âœ… 2 team members</li>
                <li>âœ… Email support</li>
                <li>âœ… 5GB storage</li>
                <li>âœ… Basic reports</li>
            </ul>
            <button onclick="selectPlan('basic')">Get Started</button>
        </div>
        
        <!-- Standard Plan -->
        <div class="card featured">
            <div class="badge">Most Popular</div>
            <h2>Standard</h2>
            <p class="price">Rp 299,000<span>/month</span></p>
            <ul>
                <li>âœ… Up to 200 customers</li>
                <li>âœ… 10 team members</li>
                <li>âœ… Priority support</li>
                <li>âœ… 20GB storage</li>
                <li>âœ… Advanced reports</li>
                <li>âœ… MikroTik integration</li>
            </ul>
            <button onclick="selectPlan('standard')">Get Started</button>
        </div>
        
        <!-- Premium Plan -->
        <div class="card">
            <h2>Premium</h2>
            <p class="price">Rp 999,000<span>/month</span></p>
            <ul>
                <li>âœ… Unlimited customers</li>
                <li>âœ… Unlimited team members</li>
                <li>âœ… 24/7 support</li>
                <li>âœ… Unlimited storage</li>
                <li>âœ… Custom reports</li>
                <li>âœ… API access</li>
                <li>âœ… White label option</li>
            </ul>
            <button onclick="selectPlan('premium')">Get Started</button>
        </div>
    </div>
    
    <script>
        function selectPlan(planSlug) {
            // Redirect to sign up with selected plan
            window.location.href = `/signup?plan=${planSlug}`;
        }
    </script>
</body>
</html>
```

---

## Recurring Billing (Auto-Renewal)

```go
// Cron job: Check subscriptions to renew (daily)
func CheckSubscriptionsToRenew() {
    // Find subscriptions expiring in 3 days
    subscriptions := subscriptionRepo.FindExpiringIn(3)
    
    for _, sub := range subscriptions {
        // Create renewal invoice
        plan := planRepo.FindByID(sub.PlanID)
        orderID := generateOrderID()
        
        transaction := &entity.PaymentTransaction{
            TenantID:       sub.TenantID,
            SubscriptionID: sub.ID,
            OrderID:        orderID,
            Amount:         plan.Price,
            Status:         "pending",
        }
        transactionRepo.Create(ctx, transaction)
        
        // Send invoice email
        tenant := tenantRepo.FindByID(sub.TenantID)
        user := userRepo.FindAdminByTenant(sub.TenantID)
        
        paymentURL := paymentGateway.CreateInvoice(orderID, plan.Price, user.Email)
        
        emailService.SendRenewalInvoice(user.Email, tenant, paymentURL)
    }
}
```

---

## Summary Alur Self-Service

1. **User Sign Up** â†’ Isi form ISP name, subdomain, email, password
2. **Choose Plan** â†’ Pilih Basic/Standard/Premium
3. **Payment** â†’ Bayar via payment gateway (Midtrans/Xendit)
4. **Auto Activation** â†’ Setelah payment confirmed:
   - âœ… Tenant activated
   - âœ… Admin account activated
   - âœ… Default data initialized
   - âœ… Welcome email sent
5. **Onboarding** â†’ Setup wizard untuk first-time setup
6. **Start Using** â†’ Langsung bisa manage customers!

**Fully automated, no manual approval!** ðŸš€

---

## Next Steps untuk Implementasi

1. âœ… Buat subscription plans table
2. âœ… Buat tenant_subscriptions table
3. âœ… Buat payment_transactions table
4. âœ… Implement public signup endpoint
5. âœ… Integrate payment gateway (Midtrans/Xendit)
6. âœ… Implement webhook handler
7. âœ… Create pricing page
8. âœ… Setup recurring billing cron job

Mau saya implementasikan fitur-fitur ini? ðŸš€
